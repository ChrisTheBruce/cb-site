{
  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "cb-site",
  "main": "worker/index.ts",
  "compatibility_date": "2025-09-01",

  // Serve built frontend from Vite's output
  "assets": {
    "directory": "dist",
    "binding": "ASSETS"
  },

  // Routes should apply only to the production environment; moved under env.production

  // Optional but handy
  "observability": { "enabled": true },

  "vars": {
      "AI_GATEWAY_BASE": "https://gateway.ai.cloudflare.com/v1/6809dd00f7144b0e15d82494016f4459/cb-openai/",
      "DEBUG_MODE": "true"
  },

  // Durable Objects bindings now live only under env.production

  "migrations": [
    {
      "tag": "v1-do-downloadlog",
      "new_sqlite_classes": ["DownloadLog"]
    }
  ],

  "env": {
    "preview": {
      "vars": { "DEBUG_MODE": "true" }
    },
    "staging": {
      // Use a separate Worker service dedicated to staging previews
      "name": "staging-cb-site",
      // Staging without Durable Objects bindings; assets still served from dist
      "vars": {
        "DEBUG_MODE": "true",
        // Mirror gateway base so chat works in staging
        "AI_GATEWAY_BASE": "https://gateway.ai.cloudflare.com/v1/6809dd00f7144b0e15d82494016f4459/cb-openai/"
      },
      "assets": {
        "directory": "dist",
        "binding": "ASSETS"
      },
      "durable_objects": { "bindings": [] }
    },
    "production": {
      "vars": { "DEBUG_MODE": "true", "AI_GATEWAY_BASE": "https://gateway.ai.cloudflare.com/v1/6809dd00f7144b0e15d82494016f4459/cb-openai/" },
      "routes": [
        { "pattern": "chrisbrighouse.com/api/*", "zone_name": "chrisbrighouse.com" },
        { "pattern": "www.chrisbrighouse.com/api/*", "zone_name": "chrisbrighouse.com" }
      ],
      "durable_objects": {
        "bindings": [
          { "name": "DOWNLOAD_LOG", "class_name": "DownloadLog" }
        ]
      },"name": "cb-site"
    }
  }

}

/*
{
  "name": "cb-site",
  "main": "worker/index.ts",            // if your fetch() is exported from worker/index.ts, change to "worker/index.ts"
  "compatibility_date": "2025-09-01",
  "tsconfig": "tsconfig.json",

  // Serve built frontend from Vite's output
  "assets": {
    "directory": "dist",
    "binding": "ASSETS"
  },


  
  // Force this service to own your domain
  "routes": [
    { "pattern": "chrisbrighouse.com/*", "zone_name": "chrisbrighouse.com" }
  ],

  // Optional but handy
  "observability": { "enabled": true },

  "vars": {
      "AI_GATEWAY_BASE": "https://gateway.ai.cloudflare.com/v1/6809dd00f7144b0e15d82494016f4459/cb-openai/",
       "DEBUG_MODE": "true"
  },


  "env": {
    "preview": {
      "vars": { "DEBUG_MODE": "true" }
    },
    "production": {
      "vars": { "DEBUG_MODE": "true" }
    }
  }

  }
*/
